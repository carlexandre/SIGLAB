<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIGLAB: Cadastro de Avisos</title>
    
    <link href="/css/cadastro.css" rel="stylesheet">

    <style>
        :root {
            --bg-color: #000000;
            --main-green: #00ff41;
            --dim-green: #008F11;
            --alert-pink: #ff00ff;
            --ui-gray: #1a1a1a;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            background-image: 
                linear-gradient(rgba(0, 255, 65, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 65, 0.03) 1px, transparent 1px);
            background-size: 20px 20px; /* Efeito de grade no fundo */
            color: var(--main-green);
            font-family: 'VT323', monospace;
            font-size: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            border: 4px solid var(--ui-gray); /* Borda na tela toda */
        }
    </style>
</head>

<%- include('partials/header') %>

<body>
    <main class="main-container">

        <h2 class="titulo-pagina">Novo Aviso</h2>
        
        <form id="form-aviso" class="form-cadastro">
        
            <div class="form-group">
                <label for="titulo">T√≠tulo:</label>
                <input type="text" id="titulo" name="titulo" placeholder="Ex: Manuten√ß√£o da Rede" required>
            </div>
            
            <div class="form-group">
                <label for="mensagem">Mensagem (Descri√ß√£o):</label>
                <textarea id="mensagem" name="mensagem" rows="4" placeholder="Descreva o aviso..." required></textarea>
            </div>

            <div class="form-group">
                <label for="tipo">Tipo:</label>
                <select id="tipo" name="tipo" required>
                    <option value="">Selecione um tipo...</option>
                    <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                    <option value="Informativo">Informativo</option>
                    <option value="Alerta">Alerta</option>
                </select>
            </div>

            <div class="form-group">
                <label for="prioridade">Prioridade:</label>
                <select id="prioridade" name="prioridade" required>
                    <option value="">Selecione a prioridade...</option>
                    <option value="Baixa">Baixa</option>
                    <option value="M√©dia">M√©dia</option>
                    <option value="Alta">Alta</option>
                    <option value="Cr√≠tica">Cr√≠tica</option>
                </select>
            </div>

            <div class="form-group">
                <label for="dataInicio">In√≠cio do Aviso:</label>
                <input type="datetime-local" id="dataInicio" name="dataInicio" required>
            </div>
            
            <div class="form-group">
                <label for="dataFim">Fim do Aviso:</label>
                <input type="datetime-local" id="dataFim" name="dataFim">
            </div>

            <div class="form-group">
                <label for="labs">Laborat√≥rios (separados por v√≠rgula):</label>
                <input type="text" id="labs" name="labs" placeholder="Ex: 101, 102, 205">
            </div>

            <button type="submit" class="btn-pixel">üíæ SALVAR AVISO</button>
        </form>
        
        <div style="margin-top: 20px; text-align: center; font-family: 'Press Start 2P', monospace;">
            <p id="feedback"></p>
        </div>

    </main>
</body>

<%- include('partials/footer') %>

<script>
    document.getElementById('form-aviso').addEventListener('submit', async (event) => {
    
        event.preventDefault();
        
        const feedbackEl = document.getElementById('feedback');
        feedbackEl.textContent = 'Processando...';
        feedbackEl.style.color = '#ffff00'; // Amarelo enquanto carrega

        const form = event.target;
        // Coletando valores
        const titulo = form.titulo.value;
        const mensagem = form.mensagem.value;
        const tipo = form.tipo.value;
        const prioridade = form.prioridade.value;
        const dataInicio = form.dataInicio.value;
        const dataFim = form.dataFim.value || null;
        const labsInput = form.labs.value;

        const labsArray = labsInput.split(',')
                                   .map(lab => lab.trim())
                                   .filter(lab => lab.length > 0);

        const dados = {
            titulo, mensagem, tipo, prioridade, dataInicio, dataFim, labs: labsArray
        };

        try {
            const response = await fetch('http://localhost:3001/api/avisos', { 
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dados)
            });

            if (response.ok) {
                feedbackEl.textContent = 'Aviso salvo com sucesso!';
                feedbackEl.style.color = '#00FF00'; // Verde Neon
                form.reset();
            } else {
                const erroData = await response.json();
                feedbackEl.textContent = `Erro: ${erroData.message || 'Falha ao salvar'}`;
                feedbackEl.style.color = '#ff5555'; // Vermelho claro (leg√≠vel no preto)
            }

        } catch (error) {
            console.error('Erro:', error);
            feedbackEl.textContent = 'Erro de conex√£o com a API.';
            feedbackEl.style.color = '#ff5555';
        }
    });
</script>